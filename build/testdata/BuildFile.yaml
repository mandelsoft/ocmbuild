
schemaVersion: v1
metadata:
  platforms:
    - linux/amd64
    - darwin/arm64

version: 0.1.0
provider:
  name: mandelsoft.org

builds:
  - pluginRef: ghcr.io/mandelsoft/ocmtest//ocm.software/buildplugins/execute
    config:
      cmd:
        - go
        - test
        - gopkgpath: ../...

components:
  - name: ocm.software/plugins/ocmbuild
    builds:
#      - pluginRef: ghcr.io/mandelsoft/ocmtest//ocm.software/buildplugins/goexecutable
      - executable: goplugin
        config:
          path: ../../../../cmds/test/build/ocmplugin
          resource:
            name: ocmbuild
            type: ocmPlugin
          platforms: (( metadata.platforms ))

  - name: ocm.software/buildplugins/goexecutable
    builds:
#      - executable: goplugin
      - pluginRef: ghcr.io/mandelsoft/ocmtest//ocm.software/buildplugins/goexecutable
        config:
          path: ../../../../cmds/test/build/plugins/gobuild
          resource:
           name: goexecutable
           type: ocm.software/buildplugin
          platforms: (( metadata.platforms ))

  - name: ocm.software/buildplugins/constructor
    builds:
      - pluginRef: ghcr.io/mandelsoft/ocmtest//ocm.software/buildplugins/goexecutable
        config:
          path: ../../../../cmds/test/build/plugins/constructor
          resource:
            name: constructor
            type: ocm.software/buildplugin
          platforms: (( metadata.platforms ))

  - name: ocm.software/buildplugins/dockerbuild
    builds:
      - pluginRef: ghcr.io/mandelsoft/ocmtest//ocm.software/buildplugins/goexecutable
        config:
          path: ../../../../cmds/test/build/plugins/dockerbuild
          resource:
            name: dockerbuild
            type: ocm.software/buildplugin
          platforms: (( metadata.platforms ))

  - name: ocm.software/buildplugins/execute
    builds:
      - pluginRef: ghcr.io/mandelsoft/ocmtest//ocm.software/buildplugins/goexecutable
        config:
          path: ../../../../cmds/test/build/plugins/execute
          resource:
            name: execute
            type: ocm.software/buildplugin
          platforms: (( metadata.platforms ))
#      - executable: testplugin
#        config:
#          constructor: test/constructor
